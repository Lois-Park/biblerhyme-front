### **바이블라임: 생성된 음원 및 메타데이터 관리 방안**

**1. 개요**

본 문서는 '바이블라임' 프로젝트를 통해 생성되는 모든 디지털 자산(음원 파일, 관련 정보)을 체계적이고 확장 가능하며, 안정적으로 관리하기 위한 기술적인 방안을 정의합니다.

**2. 핵심 원칙**

*   **관심사의 분리 (Separation of Concerns):** 대용량 바이너리 파일(음원)과 정형 데이터(메타데이터)는 물리적으로 분리하여 각 특성에 맞는 최적의 기술로 관리합니다.
*   **확장성 (Scalability):** 서비스가 성장하여 수백만 개의 음원을 보유하게 되더라도 성능 저하 없이 운영될 수 있는 클라우드 기반 아키텍처를 채택합니다.
*   **데이터 무결성 및 검색 가능성 (Integrity & Queryability):** 모든 음원은 어떤 조건(성경, 스타일, 프롬프트)으로 생성되었는지 추적 가능해야 하며, 다양한 조건으로 쉽게 검색하고 분류할 수 있어야 합니다.
*   **내구성 및 안정성 (Durability & Reliability):** 데이터 유실 위험을 최소화하고, 안정적인 서비스가 가능하도록 내구성이 높은 스토리지와 관리형 데이터베이스를 사용합니다.

**3. 데이터 모델**

#### **3.1. 음원 파일: 클라우드 객체 스토리지 (Cloud Object Storage)**

생성된 MP3 음원 파일 자체는 클라우드 객체 스토리지에 저장합니다.

*   **추천 서비스:** AWS S3, Google Cloud Storage, Azure Blob Storage
*   **선택 이유:**
    *   **확장성:** 거의 무한대의 파일을 저장할 수 있습니다.
    *   **내구성:** 99.999999999%의 데이터 내구성을 보장하여 파일 유실 위험이 거의 없습니다.
    *   **비용 효율:** 사용한 만큼만 비용을 지불하며, 장기 저장 시 비용이 저렴합니다.
    *   **CDN 연동:** CloudFront 등 CDN과 쉽게 연동하여 전 세계 사용자에게 빠르고 저렴하게 음원을 전송할 수 있습니다.

*   **폴더 구조 및 작명 규칙 (권장안):**
    논리적인 폴더 구조와 파일명 규칙을 통해 데이터를 체계적으로 관리합니다.
    ```
    s3://biblerhyme-assets/audio/{book_english}/{chapter}/{verse}/{style_id}-{uuid}.mp3
    ```
    *   **예시:** `s3://biblerhyme-assets/audio/psalms/23/1/lofi-a1b2c3d4.mp3`

#### **3.2. 메타데이터: 관계형 데이터베이스 (Relational Database)**

음원 파일을 제외한 모든 정보는 관계형 데이터베이스에 저장하여 관리합니다.

*   **추천 서비스:** PostgreSQL, MySQL (또는 클라우드 관리형 서비스인 AWS RDS, Google Cloud SQL)
*   **선택 이유:**
    *   **데이터 무결성:** 정해진 스키마에 따라 데이터의 정합성을 유지하기 용이합니다.
    *   **강력한 쿼리:** 복잡한 조건(예: '시편' 중에서 'Lofi' 스타일을 사용하고, 길이가 2분 미만인 곡)으로도 쉽게 데이터를 조회할 수 있습니다.

*   **핵심 테이블 스키마 (예시):**

    **`songs` 테이블** (모든 음원 정보)
    | Column Name           | Data Type      | Description                                      |
    | --------------------- | -------------- | ------------------------------------------------ |
    | `id`                  | UUID (PK)      | 각 음원의 고유 식별자                            |
    | `book`                | VARCHAR(50)    | 성경 이름 (예: '창세기')                         |
    | `chapter`             | INTEGER        | 장                                               |
    | `verse`               | INTEGER        | 절                                               |
    | `verse_text`          | TEXT           | 원본 성경 구절 텍스트                            |
    | `suno_lyrics_prompt`  | TEXT           | Suno에 실제 입력된 가사 프롬프트                 |
    | `style_id`            | UUID (FK)      | `styles` 테이블의 ID와 연결                      |
    | `audio_url`           | VARCHAR(1024)  | 클라우드 스토리지에 저장된 음원 파일의 URL       |
    | `duration_seconds`    | INTEGER        | 음원 길이 (초 단위)                              |
    | `file_size_bytes`     | BIGINT         | 음원 파일 크기 (바이트 단위)                     |
    | `suno_model_version`  | VARCHAR(50)    | 사용된 Suno 모델 버전 (예: 'v3.5') - 추적용      |
    | `status`              | ENUM           | 상태 ('pending_review', 'approved', 'rejected')  |
    | `created_at`          | TIMESTAMP      | 생성 시각                                        |
    | `updated_at`          | TIMESTAMP      | 마지막 수정 시각                                 |

    **`styles` 테이블** (사용된 스타일 정보)
    | Column Name         | Data Type   | Description                                      |
    | ------------------- | ----------- | ------------------------------------------------ |
    | `id`                | UUID (PK)   | 각 스타일의 고유 식별자                          |
    | `style_name`        | VARCHAR(255)| 스타일 이름 (예: 'Lofi Meditator')               |
    | `suno_style_prompt` | TEXT        | Suno에 실제 입력된 스타일 프롬프트               |
    | `description`       | TEXT        | 해당 스타일에 대한 설명                          |
    | `created_at`        | TIMESTAMP   | 생성 시각                                        |

**4. 데이터 흐름**

자동화 워크플로우의 '생성 워커'는 아래의 순서로 데이터를 처리합니다.

1.  Suno API를 통해 음원 생성 완료.
2.  생성된 MP3 파일을 다운로드.
3.  다운로드한 파일을 클라우드 스토리지(S3 등)에 **업로드**.
4.  업로드 후 받은 파일의 고유 URL을 확보.
5.  음원 메타데이터(성경 위치, 사용된 프롬프트 등)와 파일 URL을 함께 묶어 데이터베이스의 `songs` 테이블에 **INSERT**.

**5. 백업 및 복구**

*   AWS S3, AWS RDS와 같은 클라우드 관리형 서비스를 사용할 경우, 자동 백업 및 특정 시점 복구(Point-in-Time Recovery) 기능이 기본적으로 제공됩니다. 이를 활성화하여 데이터 유실 및 장애 상황에 대비합니다.