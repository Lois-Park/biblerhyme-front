### **바이블라임: 콘텐츠 버전관리 및 일관성 유지 전략**

**1. 개요**

본 문서는 바이블라임 프로젝트의 핵심 자산인 음원 콘텐츠의 품질과 일관성을 보장하고, 모든 변경 사항을 체계적으로 추적 및 관리하기 위한 버전관리 전략을 정의합니다. 이 전략은 서비스가 성장함에 따라 발생할 수 있는 콘텐츠의 혼란을 방지하고, 항상 높은 품질의 결과물을 사용자에게 제공하는 것을 목표로 합니다.

**2. 핵심 전략**

#### **2.1. 콘텐츠 불변성 (Content Immutability)**

*   **원칙:** "한 번 승인된 음원은 수정하거나 덮어쓰지 않는다."
*   **실행 방안:**
    *   생성된 모든 음원 파일과 그 메타데이터는 고유한 버전으로 취급하며, 일단 데이터베이스에 저장되면 원본은 변경되지 않습니다.
    *   기존 음원을 더 나은 AI 모델이나 새로운 스타일로 "업데이트"하고 싶을 경우, 기존 데이터를 수정하는 대신 **새로운 음원과 메타데이터를 생성**합니다.
    *   이때, 새로운 버전은 이전 버전과의 관계를 명시하며(4번 항목 참조), 이전 버전의 상태는 `deprecated`(사용 중지)로 변경합니다. 이를 통해 모든 생성 이력을 보존하고 언제든지 롤백하거나 비교할 수 있습니다.

#### **2.2. 모든 입력값의 버전화 (Version Everything)**

결과물뿐만 아니라, 결과물을 만들어낸 '레시피' 자체를 버전으로 관리하여 완벽한 추적성을 확보합니다.

*   **프롬프트 버전 관리:**
    *   `styles` 데이터베이스 테이블을 '프롬프트 라이브러리'로 활용합니다. 특정 스타일 프롬프트의 성능을 개선하고 싶을 때, 기존 프롬프트를 수정하는 대신 새로운 스타일 ID로 새 프롬프트를 추가합니다. 이를 통해 어떤 음원이 어떤 버전의 스타일 프롬프트로 생성되었는지 명확하게 알 수 있습니다.
*   **AI 모델 버전 기록:**
    *   `songs` 테이블에 `suno_model_version` 필드를 두어, 음원 생성에 사용된 AI 모델(예: "Suno V4", "Suno V5")을 명시적으로 기록합니다. 이는 나중에 특정 모델의 성능을 분석하거나, 구버전 모델로 생성된 음원들을 일괄적으로 재 생성하는 등의 작업에 필수적입니다.

#### **2.3. 콘텐츠 생명주기 관리 (Content Lifecycle Management)**

모든 음원은 명확한 상태(status) 값을 가지며, 정의된 프로세스에 따라 상태가 변경됩니다. `songs` 테이블의 `status` 필드는 아래와 같은 상태를 가집니다.

*   **`pending_review` (검수 대기):** 자동화 시스템에 의해 막 생성된 상태. 아직 사용자에게 노출되지 않으며, 품질 검수를 기다립니다.
*   **`approved` (승인):** 수동 검수를 통과하여 사용자에게 공개되도록 승인된 상태. 서비스에 노출되는 "라이브" 버전입니다.
*   **`rejected` (반려):** 자동 또는 수동 검수 과정에서 품질 미달로 판정된 상태. 사용자에게 노출되지 않으며, 원인 분석 후 삭제되거나 재 생성 절차를 밟습니다.
*   **`deprecated` (사용 중지):** 더 나은 새 버전이 `approved` 상태가 되어 대체된 이전 버전의 상태. 일반 목록에는 노출되지 않지만, 데이터는 삭제하지 않고 보존하여 이력 관리 및 비교 분석에 사용합니다.
*   **`archived` (보관):** 서비스 정책 변경 등의 이유로 더 이상 사용하지 않지만, 법적 또는 기타 이유로 기록을 남겨야 할 때 사용하는 상태.

**3. 일관성 유지 방안**

#### **3.1. 자동화된 입력값 검증 (Automated Input Validation)**

*   음원 생성 '작업(Job)'을 생성하는 단계에서, 입력되는 성경 구절, 프롬프트 등의 데이터가 사전에 정의된 규칙(Schema)에 맞는지 자동으로 검증합니다. (예: 필수 필드 누락, 데이터 타입 오류 등)

#### **3.2. 자동화된 결과물 검증 (Automated Output Validation)**

*   음원이 생성된 직후, 후처리(Post-processing) 단계에서 아래와 같은 기본적인 품질 검사를 자동으로 수행합니다.
    *   **파일 유효성 검사:** 생성된 파일이 유효한 MP3 형식인지 확인합니다.
    *   **음원 길이 검사:** 음원의 길이가 비정상적으로 짧거나(예: 5초 미만) 길지(예: 5분 초과) 않은지 확인합니다.
    *   **정적(Silence) 검사:** 음원의 대부분이 소리 없는 구간으로 채워져 있는지 확인합니다.
*   위 검사에서 하나라도 실패할 경우, 해당 음원의 상태는 자동으로 `rejected`로 변경되고 관리자에게 알림을 보냅니다.

#### **3.3. 수동 검수 프로세스 (Manual Review Process)**

*   콘텐츠 품질을 보증하는 최종 관문입니다. '콘텐츠 QA 팀'은 관리자 페이지에서 `pending_review` 상태의 모든 음원을 직접 듣고 검수합니다.
*   **주요 검수 항목:**
    *   **음악적 품질:** 듣기에 좋은가? 노이즈나 깨지는 소리는 없는가?
    *   **가사 정확도 및 발음:** AI가 성경 구절을 정확하고 명확하게 발음했는가?
    *   **스타일 일치도:** 의도한 스타일 프롬프트의 분위기와 결과물이 일치하는가?
*   검수 결과에 따라 상태를 `approved` 또는 `rejected`로 변경합니다.

**4. 버전 간의 관계 정의**

콘텐츠의 '업데이트' 이력을 명확히 하기 위해, `songs` 테이블에 아래와 같은 두 개의 컬럼을 추가하여 버전 간의 연결고리(Linked List)를 만듭니다.

| Column Name               | Data Type | Description                                    |
| ------------------------- | --------- | ---------------------------------------------- |
| `replaces_song_id`        | UUID (FK) | (선택) 이 음원이 대체하는 이전 버전 음원의 ID   |
| `is_replaced_by_song_id`  | UUID (FK) | (선택) 이 음원을 대체하는 새로운 버전 음원의 ID |

이를 통해 특정 음원의 전체 변경 이력을 쉽게 추적하고 관리할 수 있습니다.